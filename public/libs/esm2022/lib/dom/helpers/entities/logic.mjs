import { Injector, inject, runInInjectionContext } from '@angular/core';
import { tapResponse } from '@ngrx/operators';
import { patchState } from '@ngrx/signals';
import { addEntities, setAllEntities } from '@ngrx/signals/entities';
import { rxMethod } from '@ngrx/signals/rxjs-interop';
import { EMPTY, pipe, switchMap } from 'rxjs';
export function onLoadSlice(state, slice) {
    return (res) => patchState(state, { [slice]: res });
}
export function onLoadEntities(state) {
    return (res) => patchState(state, addEntities(res));
}
// Function to handle the success response of loading entities
export function onLoadCollection(state, collection) {
    return (res) => patchState(state, addEntities(res, { collection }));
}
// Function to handle the success response of loading entities
export function onUpdateCollection(state, collection) {
    return (res) => {
        patchState(state, setAllEntities(res, { collection }));
    };
}
/**
 * Creates a function that invokes a specified method on a LoaderService instance.
 * @param Loader The LoaderService instance.
 * @param methodName The name of the method to invoke on the LoaderService instance.
 * @returns A function that accepts parameters for the specified method and returns an Observable of the result.
 * @template T The type of parameters accepted by the method.
 */
export function createLoader(Loader, methodName) {
    return runInInjectionContext(inject(Injector), () => {
        const loader = inject(Loader);
        return (query) => loader[methodName](query);
    });
}
export function loadCollection(loader, next) {
    return rxMethod(pipe(switchMap((query) => loader(query).pipe(tapResponse({
        next: next,
        error: () => EMPTY,
    })))));
}
/**
 * Loads entities using the provided loader function and invokes the specified
 * callback with the result.
 * @param loader A function that accepts a query parameter of type T and returns
 *               an Observable of Entity or Entity[].
 * @param next A callback function to handle the result of the loading operation.
 * @template T The type of the query parameter.
 */
export function loadEntities(loader, next) {
    return rxMethod(pipe(switchMap((query) => loader(query).pipe(tapResponse({
        next: next,
        error: () => EMPTY,
    })))));
}
export function loadSlice(loader, state, slice) {
    return rxMethod(pipe(switchMap((query) => loader(query).pipe(tapResponse({
        next: (res) => patchState(state, { [slice]: res }),
        error: () => EMPTY,
    })))));
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibG9naWMuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi8uLi9saWJzL3NyYy9saWIvZG9tL2hlbHBlcnMvZW50aXRpZXMvbG9naWMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLFFBQVEsRUFBRSxNQUFNLEVBQUUscUJBQXFCLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDeEUsT0FBTyxFQUFFLFdBQVcsRUFBRSxNQUFNLGlCQUFpQixDQUFDO0FBQzlDLE9BQU8sRUFBZSxVQUFVLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDeEQsT0FBTyxFQUFZLFdBQVcsRUFBRSxjQUFjLEVBQUUsTUFBTSx3QkFBd0IsQ0FBQztBQUMvRSxPQUFPLEVBQUUsUUFBUSxFQUFFLE1BQU0sNEJBQTRCLENBQUM7QUFDdEQsT0FBTyxFQUFFLEtBQUssRUFBYyxJQUFJLEVBQUUsU0FBUyxFQUFFLE1BQU0sTUFBTSxDQUFDO0FBRzFELE1BQU0sVUFBVSxXQUFXLENBQ3pCLEtBQTBCLEVBQzFCLEtBQWdDO0lBRWhDLE9BQU8sQ0FBQyxHQUFzQixFQUFFLEVBQUUsQ0FBQyxVQUFVLENBQUMsS0FBSyxFQUFFLEVBQUUsQ0FBQyxLQUFLLENBQUMsRUFBRSxHQUFHLEVBQUUsQ0FBQyxDQUFDO0FBQ3pFLENBQUM7QUFFRCxNQUFNLFVBQVUsY0FBYyxDQUM1QixLQUEwQjtJQUUxQixPQUFPLENBQUMsR0FBYSxFQUFFLEVBQUUsQ0FBQyxVQUFVLENBQUMsS0FBSyxFQUFFLFdBQVcsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDO0FBQ2hFLENBQUM7QUFFRCw4REFBOEQ7QUFDOUQsTUFBTSxVQUFVLGdCQUFnQixDQUM5QixLQUEwQixFQUMxQixVQUFrQjtJQUVsQixPQUFPLENBQUMsR0FBc0IsRUFBRSxFQUFFLENBQ2hDLFVBQVUsQ0FBQyxLQUFLLEVBQUUsV0FBVyxDQUFDLEdBQWUsRUFBRSxFQUFFLFVBQVUsRUFBRSxDQUFDLENBQUMsQ0FBQztBQUNwRSxDQUFDO0FBRUQsOERBQThEO0FBQzlELE1BQU0sVUFBVSxrQkFBa0IsQ0FDaEMsS0FBMEIsRUFDMUIsVUFBa0I7SUFFbEIsT0FBTyxDQUFDLEdBQXNCLEVBQUUsRUFBRTtRQUNoQyxVQUFVLENBQ1IsS0FBNEIsRUFDNUIsY0FBYyxDQUFDLEdBQWUsRUFBRSxFQUFFLFVBQVUsRUFBRSxDQUFDLENBQ2hELENBQUM7SUFDSixDQUFDLENBQUM7QUFDSixDQUFDO0FBRUQ7Ozs7OztHQU1HO0FBRUgsTUFBTSxVQUFVLFlBQVksQ0FDMUIsTUFBc0QsRUFDdEQsVUFBa0I7SUFFbEIsT0FBTyxxQkFBcUIsQ0FBQyxNQUFNLENBQUMsUUFBUSxDQUFDLEVBQUUsR0FBRyxFQUFFO1FBQ2xELE1BQU0sTUFBTSxHQUFHLE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQztRQUM5QixPQUFPLENBQUMsS0FBUSxFQUFFLEVBQUUsQ0FBQyxNQUFNLENBQUMsVUFBVSxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUM7SUFDakQsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDO0FBRUQsTUFBTSxVQUFVLGNBQWMsQ0FDNUIsTUFBMEMsRUFDMUMsSUFBK0I7SUFFL0IsT0FBTyxRQUFRLENBQ2IsSUFBSSxDQUNGLFNBQVMsQ0FBQyxDQUFDLEtBQUssRUFBRSxFQUFFLENBQ2xCLE1BQU0sQ0FBQyxLQUFLLENBQUMsQ0FBQyxJQUFJLENBQ2hCLFdBQVcsQ0FBQztRQUNWLElBQUksRUFBRSxJQUFJO1FBQ1YsS0FBSyxFQUFFLEdBQUcsRUFBRSxDQUFDLEtBQUs7S0FDbkIsQ0FBQyxDQUNILENBQ0YsQ0FDRixDQUNGLENBQUM7QUFDSixDQUFDO0FBRUQ7Ozs7Ozs7R0FPRztBQUVILE1BQU0sVUFBVSxZQUFZLENBQzFCLE1BQW1ELEVBQ25ELElBQXdDO0lBRXhDLE9BQU8sUUFBUSxDQUNiLElBQUksQ0FDRixTQUFTLENBQUMsQ0FBQyxLQUFLLEVBQUUsRUFBRSxDQUNsQixNQUFNLENBQUMsS0FBSyxDQUFDLENBQUMsSUFBSSxDQUNoQixXQUFXLENBQUM7UUFDVixJQUFJLEVBQUUsSUFBSTtRQUNWLEtBQUssRUFBRSxHQUFHLEVBQUUsQ0FBQyxLQUFLO0tBQ25CLENBQUMsQ0FDSCxDQUNGLENBQ0YsQ0FDRixDQUFDO0FBQ0osQ0FBQztBQUVELE1BQU0sVUFBVSxTQUFTLENBQ3ZCLE1BQW1ELEVBQ25ELEtBQTBCLEVBQzFCLEtBQWE7SUFFYixPQUFPLFFBQVEsQ0FDYixJQUFJLENBQ0YsU0FBUyxDQUFDLENBQUMsS0FBUSxFQUFFLEVBQUUsQ0FDckIsTUFBTSxDQUFDLEtBQUssQ0FBQyxDQUFDLElBQUksQ0FDaEIsV0FBVyxDQUFDO1FBQ1YsSUFBSSxFQUFFLENBQUMsR0FBc0IsRUFBRSxFQUFFLENBQy9CLFVBQVUsQ0FBQyxLQUFLLEVBQUUsRUFBRSxDQUFDLEtBQUssQ0FBQyxFQUFFLEdBQUcsRUFBRSxDQUFDO1FBQ3JDLEtBQUssRUFBRSxHQUFHLEVBQUUsQ0FBQyxLQUFLO0tBQ25CLENBQUMsQ0FDSCxDQUNGLENBQ0YsQ0FDRixDQUFDO0FBQ0osQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEluamVjdG9yLCBpbmplY3QsIHJ1bkluSW5qZWN0aW9uQ29udGV4dCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgdGFwUmVzcG9uc2UgfSBmcm9tICdAbmdyeC9vcGVyYXRvcnMnO1xuaW1wb3J0IHsgU3RhdGVTaWduYWwsIHBhdGNoU3RhdGUgfSBmcm9tICdAbmdyeC9zaWduYWxzJztcbmltcG9ydCB7IEVudGl0eUlkLCBhZGRFbnRpdGllcywgc2V0QWxsRW50aXRpZXMgfSBmcm9tICdAbmdyeC9zaWduYWxzL2VudGl0aWVzJztcbmltcG9ydCB7IHJ4TWV0aG9kIH0gZnJvbSAnQG5ncngvc2lnbmFscy9yeGpzLWludGVyb3AnO1xuaW1wb3J0IHsgRU1QVFksIE9ic2VydmFibGUsIHBpcGUsIHN3aXRjaE1hcCB9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHsgRW50aXR5LCBFbnRpdHlMb2FkZXIsIExvYWRlclNlcnZpY2UgfSBmcm9tICcuL3R5cGVzJztcblxuZXhwb3J0IGZ1bmN0aW9uIG9uTG9hZFNsaWNlPEVudGl0eSBleHRlbmRzIHsgaWQ6IEVudGl0eUlkIH0+KFxuICBzdGF0ZTogU3RhdGVTaWduYWw8b2JqZWN0PixcbiAgc2xpY2U6IGtleW9mIFN0YXRlU2lnbmFsPG9iamVjdD5cbikge1xuICByZXR1cm4gKHJlczogRW50aXR5W10gfCBFbnRpdHkpID0+IHBhdGNoU3RhdGUoc3RhdGUsIHsgW3NsaWNlXTogcmVzIH0pO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gb25Mb2FkRW50aXRpZXM8RW50aXR5IGV4dGVuZHMgeyBpZDogRW50aXR5SWQgfT4oXG4gIHN0YXRlOiBTdGF0ZVNpZ25hbDxvYmplY3Q+XG4pIHtcbiAgcmV0dXJuIChyZXM6IEVudGl0eVtdKSA9PiBwYXRjaFN0YXRlKHN0YXRlLCBhZGRFbnRpdGllcyhyZXMpKTtcbn1cblxuLy8gRnVuY3Rpb24gdG8gaGFuZGxlIHRoZSBzdWNjZXNzIHJlc3BvbnNlIG9mIGxvYWRpbmcgZW50aXRpZXNcbmV4cG9ydCBmdW5jdGlvbiBvbkxvYWRDb2xsZWN0aW9uPEVudGl0eSBleHRlbmRzIHsgaWQ6IEVudGl0eUlkIH0+KFxuICBzdGF0ZTogU3RhdGVTaWduYWw8b2JqZWN0PixcbiAgY29sbGVjdGlvbjogc3RyaW5nXG4pIHtcbiAgcmV0dXJuIChyZXM6IEVudGl0eVtdIHwgRW50aXR5KSA9PlxuICAgIHBhdGNoU3RhdGUoc3RhdGUsIGFkZEVudGl0aWVzKHJlcyBhcyBFbnRpdHlbXSwgeyBjb2xsZWN0aW9uIH0pKTtcbn1cblxuLy8gRnVuY3Rpb24gdG8gaGFuZGxlIHRoZSBzdWNjZXNzIHJlc3BvbnNlIG9mIGxvYWRpbmcgZW50aXRpZXNcbmV4cG9ydCBmdW5jdGlvbiBvblVwZGF0ZUNvbGxlY3Rpb248RW50aXR5IGV4dGVuZHMgeyBpZDogRW50aXR5SWQgfT4oXG4gIHN0YXRlOiBTdGF0ZVNpZ25hbDxvYmplY3Q+LFxuICBjb2xsZWN0aW9uOiBzdHJpbmdcbikge1xuICByZXR1cm4gKHJlczogRW50aXR5W10gfCBFbnRpdHkpID0+IHtcbiAgICBwYXRjaFN0YXRlKFxuICAgICAgc3RhdGUgYXMgU3RhdGVTaWduYWw8b2JqZWN0PixcbiAgICAgIHNldEFsbEVudGl0aWVzKHJlcyBhcyBFbnRpdHlbXSwgeyBjb2xsZWN0aW9uIH0pXG4gICAgKTtcbiAgfTtcbn1cblxuLyoqXG4gKiBDcmVhdGVzIGEgZnVuY3Rpb24gdGhhdCBpbnZva2VzIGEgc3BlY2lmaWVkIG1ldGhvZCBvbiBhIExvYWRlclNlcnZpY2UgaW5zdGFuY2UuXG4gKiBAcGFyYW0gTG9hZGVyIFRoZSBMb2FkZXJTZXJ2aWNlIGluc3RhbmNlLlxuICogQHBhcmFtIG1ldGhvZE5hbWUgVGhlIG5hbWUgb2YgdGhlIG1ldGhvZCB0byBpbnZva2Ugb24gdGhlIExvYWRlclNlcnZpY2UgaW5zdGFuY2UuXG4gKiBAcmV0dXJucyBBIGZ1bmN0aW9uIHRoYXQgYWNjZXB0cyBwYXJhbWV0ZXJzIGZvciB0aGUgc3BlY2lmaWVkIG1ldGhvZCBhbmQgcmV0dXJucyBhbiBPYnNlcnZhYmxlIG9mIHRoZSByZXN1bHQuXG4gKiBAdGVtcGxhdGUgVCBUaGUgdHlwZSBvZiBwYXJhbWV0ZXJzIGFjY2VwdGVkIGJ5IHRoZSBtZXRob2QuXG4gKi9cblxuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZUxvYWRlcjxUPihcbiAgTG9hZGVyOiBMb2FkZXJTZXJ2aWNlPEVudGl0eUxvYWRlcjxULCBFbnRpdHksIHN0cmluZz4+LFxuICBtZXRob2ROYW1lOiBzdHJpbmdcbik6ICguLi5hcmdzOiBUW10pID0+IE9ic2VydmFibGU8RW50aXR5W10gfCBFbnRpdHk+IHtcbiAgcmV0dXJuIHJ1bkluSW5qZWN0aW9uQ29udGV4dChpbmplY3QoSW5qZWN0b3IpLCAoKSA9PiB7XG4gICAgY29uc3QgbG9hZGVyID0gaW5qZWN0KExvYWRlcik7XG4gICAgcmV0dXJuIChxdWVyeTogVCkgPT4gbG9hZGVyW21ldGhvZE5hbWVdKHF1ZXJ5KTtcbiAgfSk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBsb2FkQ29sbGVjdGlvbjxUPihcbiAgbG9hZGVyOiAocXVlcnk6IFQpID0+IE9ic2VydmFibGU8RW50aXR5W10+LFxuICBuZXh0OiAodmFsdWU6IEVudGl0eVtdKSA9PiB2b2lkXG4pIHtcbiAgcmV0dXJuIHJ4TWV0aG9kPFQ+KFxuICAgIHBpcGUoXG4gICAgICBzd2l0Y2hNYXAoKHF1ZXJ5KSA9PlxuICAgICAgICBsb2FkZXIocXVlcnkpLnBpcGUoXG4gICAgICAgICAgdGFwUmVzcG9uc2Uoe1xuICAgICAgICAgICAgbmV4dDogbmV4dCxcbiAgICAgICAgICAgIGVycm9yOiAoKSA9PiBFTVBUWSxcbiAgICAgICAgICB9KVxuICAgICAgICApXG4gICAgICApXG4gICAgKVxuICApO1xufVxuXG4vKipcbiAqIExvYWRzIGVudGl0aWVzIHVzaW5nIHRoZSBwcm92aWRlZCBsb2FkZXIgZnVuY3Rpb24gYW5kIGludm9rZXMgdGhlIHNwZWNpZmllZFxuICogY2FsbGJhY2sgd2l0aCB0aGUgcmVzdWx0LlxuICogQHBhcmFtIGxvYWRlciBBIGZ1bmN0aW9uIHRoYXQgYWNjZXB0cyBhIHF1ZXJ5IHBhcmFtZXRlciBvZiB0eXBlIFQgYW5kIHJldHVybnNcbiAqICAgICAgICAgICAgICAgYW4gT2JzZXJ2YWJsZSBvZiBFbnRpdHkgb3IgRW50aXR5W10uXG4gKiBAcGFyYW0gbmV4dCBBIGNhbGxiYWNrIGZ1bmN0aW9uIHRvIGhhbmRsZSB0aGUgcmVzdWx0IG9mIHRoZSBsb2FkaW5nIG9wZXJhdGlvbi5cbiAqIEB0ZW1wbGF0ZSBUIFRoZSB0eXBlIG9mIHRoZSBxdWVyeSBwYXJhbWV0ZXIuXG4gKi9cblxuZXhwb3J0IGZ1bmN0aW9uIGxvYWRFbnRpdGllczxUPihcbiAgbG9hZGVyOiAocXVlcnk6IFQpID0+IE9ic2VydmFibGU8RW50aXR5W10gfCBFbnRpdHk+LFxuICBuZXh0OiAodmFsdWU6IEVudGl0eVtdIHwgRW50aXR5KSA9PiB2b2lkXG4pIHtcbiAgcmV0dXJuIHJ4TWV0aG9kPFQ+KFxuICAgIHBpcGUoXG4gICAgICBzd2l0Y2hNYXAoKHF1ZXJ5KSA9PlxuICAgICAgICBsb2FkZXIocXVlcnkpLnBpcGUoXG4gICAgICAgICAgdGFwUmVzcG9uc2Uoe1xuICAgICAgICAgICAgbmV4dDogbmV4dCxcbiAgICAgICAgICAgIGVycm9yOiAoKSA9PiBFTVBUWSxcbiAgICAgICAgICB9KVxuICAgICAgICApXG4gICAgICApXG4gICAgKVxuICApO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gbG9hZFNsaWNlPFQ+KFxuICBsb2FkZXI6IChxdWVyeTogVCkgPT4gT2JzZXJ2YWJsZTxFbnRpdHlbXSB8IEVudGl0eT4sXG4gIHN0YXRlOiBTdGF0ZVNpZ25hbDxvYmplY3Q+LFxuICBzbGljZTogc3RyaW5nXG4pIHtcbiAgcmV0dXJuIHJ4TWV0aG9kPFQ+KFxuICAgIHBpcGUoXG4gICAgICBzd2l0Y2hNYXAoKHF1ZXJ5OiBUKSA9PlxuICAgICAgICBsb2FkZXIocXVlcnkpLnBpcGUoXG4gICAgICAgICAgdGFwUmVzcG9uc2Uoe1xuICAgICAgICAgICAgbmV4dDogKHJlczogRW50aXR5W10gfCBFbnRpdHkpID0+XG4gICAgICAgICAgICAgIHBhdGNoU3RhdGUoc3RhdGUsIHsgW3NsaWNlXTogcmVzIH0pLFxuICAgICAgICAgICAgZXJyb3I6ICgpID0+IEVNUFRZLFxuICAgICAgICAgIH0pXG4gICAgICAgIClcbiAgICAgIClcbiAgICApXG4gICk7XG59XG4iXX0=